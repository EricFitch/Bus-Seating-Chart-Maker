<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bus Seating Chart Maker</title>
  <meta name="description" content="Design and print bus seating charts" />

  <!-- Tailwind CSS (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <link rel="stylesheet" href="./assets/styles.css" />
</head>
<body class="bg-slate-100 text-slate-900">
  <!-- Main grid layout -->
  <div class="min-h-dvh flex flex-col lg:grid lg:grid-cols-[320px_1fr]">
    <!-- Sidebar: navigation and controls -->
    <aside class="no-print bg-white border-b lg:border-r lg:border-b-0 border-slate-200 p-2 lg:p-4 flex flex-col space-y-2 lg:space-y-4 order-2 lg:order-1" aria-label="Sidebar">
      <header class="order-0">
        <h1 class="text-lg lg:text-xl font-bold" aria-label="Bus Seating Chart Title">ğŸª‘ Bus Seating Chart</h1>
      </header>

      <!-- Layout Controls (rows only for bench layout) -->
      <section class="space-y-2 order-1" aria-labelledby="layout-heading">
        <h2 id="layout-heading" class="font-semibold">Layout</h2>
        <form aria-label="Layout controls">
          <div class="grid grid-cols-2 gap-2">
            <label class="text-sm col-span-2" for="rows">Rows
              <input id="rows" name="rows" type="number" min="1" value="13" class="w-full mt-1 border rounded px-2 py-1" aria-label="Number of rows" />
            </label>
          </div>
          <p class="text-xs text-slate-500">Bench layout uses 2 benches per row with 3 seats per side (A/B/C). Aisle is fixed.</p>
          <button id="applyLayout" type="button" class="mt-2 w-full bg-blue-600 text-white rounded px-3 py-2 hover:bg-blue-500 active:scale-[.99] transition text-sm lg:text-base touch-manipulation" aria-label="Apply layout">Apply Layout</button>
        </form>
      </section>

      <!-- Roster Input -->
      <details class="order-2" open>
        <summary class="font-semibold cursor-pointer select-none py-2 lg:hidden list-none">
          <span class="inline-flex items-center gap-2">
            <span class="arrow">â–¶</span>
            ğŸ“‹ Roster
            <span class="text-xs text-slate-500 font-normal">(tap to expand)</span>
          </span>
        </summary>
        <h2 id="roster-heading" class="font-semibold hidden lg:block">Roster</h2>
      <section id="roster-input" class="space-y-2" aria-labelledby="roster-heading">
        <nav aria-label="Roster input tabs" class="flex border-b border-slate-200">
          <button class="tab-button active px-3 py-2 text-sm" data-tab="upload-csv" aria-controls="upload-csv">Upload CSV</button>
          <button class="tab-button px-3 py-2 text-sm" data-tab="add-manual" aria-controls="add-manual">Add Manually</button>
        </nav>
        <div id="upload-csv" class="tab-content space-y-2" role="tabpanel" aria-labelledby="upload-csv-tab">
          <p class="text-xs text-slate-600">CSV format: <code>Last Name,First Name,Grade</code></p>
          <label for="csv-file" class="text-sm">Upload CSV</label>
          <input type="file" id="csv-file" accept=".csv" class="w-full border rounded px-2 py-1" aria-label="Upload CSV" />
        </div>
        <div id="add-manual" class="tab-content hidden" role="tabpanel" aria-labelledby="add-manual-tab">
          <form id="add-student-form" class="space-y-2" aria-label="Add student manually">
            <label for="first-name">First Name
              <input type="text" id="first-name" name="first-name" placeholder="First Name" required class="w-full border rounded px-2 py-1" />
            </label>
            <label for="last-name">Last Name
              <input type="text" id="last-name" name="last-name" placeholder="Last Name" required class="w-full border rounded px-2 py-1" />
            </label>
            <label for="grade">Grade
              <input type="text" id="grade" name="grade" placeholder="Grade (e.g., PK, KG, 01)" required class="w-full border rounded px-2 py-1" />
            </label>
            <button type="submit" class="w-full bg-emerald-600 text-white rounded px-3 py-2 hover:bg-emerald-500 active:scale-[.99] transition" aria-label="Add student">Add Student</button>
          </form>
        </div>
      </section>
      </details>

      <!-- Unassigned List -->
      <details class="order-2" open>
        <summary class="font-semibold cursor-pointer select-none py-2 lg:hidden list-none">
          <span class="inline-flex items-center gap-2">
            <span class="arrow">â–¶</span>
            ğŸ‘¥ Unassigned Students
          </span>
        </summary>
      <section class="space-y-2 min-h-40 flex flex-col" aria-labelledby="unassigned-heading">
        <div class="flex items-center justify-between">
          <h3 id="unassigned-heading" class="text-sm font-medium hidden lg:block">Unassigned Students</h3>
          <h3 class="text-sm font-medium lg:hidden">Students</h3>
          <button id="sort-toggle-btn" type="button" class="text-xs bg-slate-200 hover:bg-slate-300 text-slate-700 px-2 py-1 rounded transition" title="Toggle sort order">
            Sort: Last Name
          </button>
        </div>
        <ul id="unassignedList" class="min-h-24 bg-slate-50 border border-slate-200 rounded p-2 space-y-1 flex-1 overflow-auto" aria-label="Unassigned students list"></ul>
      </section>
      </details>

      <!-- Mobile Usage Instructions -->
      <section class="lg:hidden bg-blue-50 border border-blue-200 rounded p-3 text-sm space-y-1 order-3" aria-labelledby="mobile-instructions-heading">
        <h3 id="mobile-instructions-heading" class="font-medium text-blue-900">ğŸ“± Mobile Instructions</h3>
        <p class="text-blue-800">â€¢ Tap students in the roster to assign them to the first available seat</p>
        <p class="text-blue-800">â€¢ Tap empty seats to choose a student to assign</p>
        <p class="text-blue-800">â€¢ Tap occupied seats to remove the student</p>
        <p class="text-blue-800">â€¢ Scroll the seating chart horizontally if needed</p>
      </section>

      <!-- Desktop Usage Instructions -->
      <section class="hidden lg:block bg-blue-50 border border-blue-200 rounded p-3 text-sm space-y-1 order-3" aria-labelledby="desktop-instructions-heading">
        <h3 id="desktop-instructions-heading" class="font-medium text-blue-900">ğŸ–±ï¸ Desktop Instructions</h3>
        <p class="text-blue-800">â€¢ Drag students from roster to empty seats to assign</p>
        <p class="text-blue-800">â€¢ Drag between seats to swap students</p>
        <p class="text-blue-800">â€¢ Drag to "Unassigned Students" list to remove from seat</p>
        <p class="text-blue-800">â€¢ Click empty seats to pick from a list</p>
      </section>

      <!-- Theme Controls -->
      <section class="no-print space-y-2 order-4" aria-labelledby="theme-heading">
        <h2 id="theme-heading" class="font-semibold">Theme & Print</h2>
        <div class="space-y-3">
          <div class="flex items-center gap-2">
            <label class="text-sm" for="theme-selector">Theme</label>
            <select id="theme-selector" class="border rounded px-2 py-1 text-sm flex-1" aria-label="Theme selector"></select>
          </div>
          
          <!-- Print Options -->
          <details class="bg-slate-50 border border-slate-200 rounded" open>
            <summary class="cursor-pointer p-2 text-xs font-medium text-slate-700 hover:bg-slate-100 rounded-t select-none">
              ğŸ–¨ï¸ Print Options
            </summary>
            <div class="p-2 pt-0 space-y-1">
              <label class="flex items-center gap-2 text-xs cursor-pointer">
                <input type="checkbox" id="print-show-bench-numbers" checked class="rounded" />
                <span>Show bench seat numbers</span>
              </label>
              <label class="flex items-center gap-2 text-xs cursor-pointer">
                <input type="checkbox" id="print-show-row-numbers" checked class="rounded" />
                <span>Show row numbers</span>
              </label>
              <label class="flex items-center gap-2 text-xs cursor-pointer">
                <input type="checkbox" id="print-show-seat-positions" checked class="rounded" />
                <span>Show seat positions (Window/Middle/Aisle)</span>
              </label>
              <label class="flex items-center gap-2 text-xs cursor-pointer">
                <input type="checkbox" id="print-show-theme-icons" checked class="rounded" />
                <span>Show theme icons</span>
              </label>
            </div>
          </details>
          
          <div class="flex flex-col gap-2">
            <button class="print-btn bg-emerald-600 text-white rounded-lg px-4 py-3 hover:bg-emerald-500 active:scale-[.99] transition disabled:opacity-50 text-base font-medium touch-manipulation shadow-sm" id="print-chart-btn" disabled aria-label="Print seating chart">ğŸ–¨ï¸ Print Chart</button>
            <button class="print-btn bg-emerald-600 text-white rounded-lg px-4 py-3 hover:bg-emerald-500 active:scale-[.99] transition disabled:opacity-50 text-base font-medium touch-manipulation shadow-sm" id="print-tags-btn" disabled aria-label="Print name tags">ğŸ·ï¸ Print Tags</button>
            <button class="print-btn bg-emerald-700 text-white rounded-lg px-4 py-3 hover:bg-emerald-600 active:scale-[.99] transition disabled:opacity-50 text-base font-medium touch-manipulation shadow-sm" id="print-icons-btn" disabled aria-label="Print bench icons">ğŸ¨ Print Bench Icons</button>
          </div>
          
          <!-- Export/Import Section -->
          <div class="border-t border-slate-200 pt-3 mt-2 space-y-2">
            <h3 class="text-xs font-medium text-slate-700">Save & Load</h3>
            <button class="w-full bg-blue-600 text-white rounded px-3 py-2 hover:bg-blue-500 active:scale-[.99] transition text-sm touch-manipulation" id="export-btn" aria-label="Export seating chart">Export Seating Chart</button>
            <label class="block">
              <span class="sr-only">Import seating chart file</span>
              <input type="file" id="import-file" accept=".json" class="hidden" aria-label="Import seating chart" />
              <button type="button" class="w-full bg-blue-600 text-white rounded px-3 py-2 hover:bg-blue-500 active:scale-[.99] transition text-sm touch-manipulation" id="import-btn" aria-label="Load seating chart">Load Seating Chart</button>
            </label>
            <button class="w-full bg-red-600 text-white rounded px-3 py-2 hover:bg-red-500 active:scale-[.99] transition text-sm touch-manipulation" id="clear-all-btn" aria-label="Clear all seat assignments">ğŸ—‘ï¸ Clear All Assignments</button>
          </div>
        </div>
      </section>

      <!-- Grade Color Legend -->
      <section class="space-y-3 order-5" aria-labelledby="grade-legend-heading">
        <h2 id="grade-legend-heading" class="font-semibold text-base">ğŸ¨ Grade Color Legend</h2>
        <form id="grade-color-legend" class="grid grid-cols-2 gap-3 text-sm" aria-label="Grade color legend">
          <label for="color-pk" class="flex items-center gap-2 cursor-pointer"><span class="w-8 text-center font-medium">PK</span><input id="color-pk" type="color" name="PK" value="#FFD966" class="w-10 h-10 rounded cursor-pointer" /></label>
          <label for="color-kg" class="flex items-center gap-2 cursor-pointer"><span class="w-8 text-center font-medium">KG</span><input id="color-kg" type="color" name="KG" value="#C9DAF8" class="w-10 h-10 rounded cursor-pointer" /></label>
          <label for="color-01" class="flex items-center gap-2 cursor-pointer"><span class="w-8 text-center font-medium">01</span><input id="color-01" type="color" name="01" value="#D9EAD3" class="w-10 h-10 rounded cursor-pointer" /></label>
          <label for="color-02" class="flex items-center gap-2 cursor-pointer"><span class="w-8 text-center font-medium">02</span><input id="color-02" type="color" name="02" value="#F4CCCC" class="w-10 h-10 rounded cursor-pointer" /></label>
          <label for="color-03" class="flex items-center gap-2 cursor-pointer"><span class="w-8 text-center font-medium">03</span><input id="color-03" type="color" name="03" value="#EAD1DC" class="w-10 h-10 rounded cursor-pointer" /></label>
          <label for="color-04" class="flex items-center gap-2 cursor-pointer"><span class="w-8 text-center font-medium">04</span><input id="color-04" type="color" name="04" value="#FFF2CC" class="w-10 h-10 rounded cursor-pointer" /></label>
          <label for="color-05" class="flex items-center gap-2 cursor-pointer"><span class="w-8 text-center font-medium">05</span><input id="color-05" type="color" name="05" value="#D0E0E3" class="w-10 h-10 rounded cursor-pointer" /></label>
          <label for="color-06" class="flex items-center gap-2 cursor-pointer"><span class="w-8 text-center font-medium">06</span><input id="color-06" type="color" name="06" value="#FDE68A" class="w-10 h-10 rounded cursor-pointer" /></label>
          <label for="color-07" class="flex items-center gap-2 cursor-pointer"><span class="w-8 text-center font-medium">07</span><input id="color-07" type="color" name="07" value="#A7F3D0" class="w-10 h-10 rounded cursor-pointer" /></label>
          <label for="color-08" class="flex items-center gap-2 cursor-pointer"><span class="w-8 text-center font-medium">08</span><input id="color-08" type="color" name="08" value="#FCA5A5" class="w-10 h-10 rounded cursor-pointer" /></label>
          <label for="color-09" class="flex items-center gap-2 cursor-pointer"><span class="w-8 text-center font-medium">09</span><input id="color-09" type="color" name="09" value="#C4B5FD" class="w-10 h-10 rounded cursor-pointer" /></label>
          <label for="color-10" class="flex items-center gap-2 cursor-pointer"><span class="w-8 text-center font-medium">10</span><input id="color-10" type="color" name="10" value="#FBCFE8" class="w-10 h-10 rounded cursor-pointer" /></label>
          <label for="color-11" class="flex items-center gap-2 cursor-pointer"><span class="w-8 text-center font-medium">11</span><input id="color-11" type="color" name="11" value="#F9A8D4" class="w-10 h-10 rounded cursor-pointer" /></label>
          <label for="color-12" class="flex items-center gap-2 cursor-pointer"><span class="w-8 text-center font-medium">12</span><input id="color-12" type="color" name="12" value="#A3E635" class="w-10 h-10 rounded cursor-pointer" /></label>
        </form>
        <p class="text-xs text-slate-600 leading-relaxed">ğŸ’¡ Click a color to customize grade highlights</p>
      </section>
    </aside>

    <!-- Main content -->
    <main class="p-2 lg:p-4 order-1 lg:order-2" aria-label="Main content">
      <div class="max-w-6xl mx-auto">
        <!-- Title & Meta -->
        <header class="no-print flex flex-col lg:flex-row lg:items-center justify-between mb-4 gap-2">
          <div>
            <h2 class="text-xl lg:text-2xl font-semibold">Current Bus Layout</h2>
            <p id="meta" class="text-sm text-slate-600">8 rows Ã— 4 seats/row â€¢ Aisle: yes</p>
          </div>
          <div class="text-sm text-slate-600">Last saved: <span id="lastSaved">never</span></div>
        </header>

        <!-- Seating Status Progress Bar -->
        <div class="no-print bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4">
          <div class="flex items-center justify-between text-sm mb-2">
            <div>
              <span class="font-semibold" id="stats-assigned">0</span> / <span id="stats-total">0</span> seats filled
            </div>
            <div class="flex gap-3">
              <span class="flex items-center gap-1">
                <span class="w-3 h-3 rounded-full bg-emerald-400"></span>
                <span class="text-xs">Filled</span>
              </span>
              <span class="flex items-center gap-1">
                <span class="w-3 h-3 rounded-full border-2 border-dashed border-slate-400 bg-slate-50"></span>
                <span class="text-xs">Empty</span>
              </span>
            </div>
          </div>
          <div class="h-2 bg-slate-200 rounded-full overflow-hidden">
            <div id="progress-bar" class="h-full bg-emerald-500 transition-all duration-300" style="width: 0%"></div>
          </div>
        </div>

        <!-- Seating Chart (table bench layout) -->
        <section id="seating-chart-container" class="bg-white p-2 sm:p-4 rounded shadow-sm print:shadow-none border border-transparent overflow-x-auto relative" aria-label="Seating chart">
          <div id="scroll-hint" class="lg:hidden absolute top-2 right-2 bg-blue-600 text-white text-xs px-3 py-1.5 rounded-full shadow-lg animate-pulse z-10">
            â† Swipe to see all seats â†’
          </div>
          <div class="min-w-max">
            <table id="seating-chart" class="w-full border-collapse" aria-label="Bus seating chart"></table>
          </div>
        </section>
      </div>
    </main>
  </div>

  <!-- Utility functions (must come before app.js) -->
  <script src="./src/utils.js"></script>
  <!-- Themes script (must come before app.js) -->
  <script src="./src/themes.js"></script>
  <!-- Modularized logic -->
  <script src="./src/roster.js"></script>
  <script src="./src/seatingChart.js"></script>
  <script src="./src/dragdrop.js"></script>
  <script src="./src/modal.js"></script>
  <script src="./src/gradeColors.js"></script>
  <!-- App script -->
  <script src="./src/app.js"></script>
  <!-- Simple modal root for pickers -->
  <div id="modal-root" class="no-print modal-root">
    <div id="modal-backdrop" class="modal-backdrop"></div>
    <div id="modal-panel" class="modal-panel">
      <div id="modal-content"></div>
    </div>
  </div>
</body>
</html>
